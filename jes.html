<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

<style>
  #translate-container {
    position: fixed; bottom: 1vh; right: 2vw;
    z-index: 1000;
    font-family: sans-serif;
  }
  #translate-btn {
    background: rgba(255,255,255,0.5);
    border: 1px solid black;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }
  #lang-menu {
    display: none;
    position: absolute;
    bottom: 2.8em;
    right: 0;
    background: white;
    border: 1px solid black;
    border-radius: 4px;
    overflow-y: auto;
    max-height: 250px;
    min-width: 150px;
  }
  #lang-menu div {
    padding: 0.5rem 1rem;
    cursor: pointer;
  }
  #lang-menu div:hover { background: #eee; }
  #google_translate_element { display: none; }
  .goog-te-banner-frame.skiptranslate { display: none !important; }
</style>

<div id="google_translate_element"></div>

<div id="translate-container">
  <div id="translate-btn">
    ğŸŒ Translate <span class="material-icons">expand_more</span>
  </div>
  <div id="lang-menu"></div>
</div>

<div style="padding:2rem;">
  <h1>What is PortaFlux?</h1>
  <p>PortaFlux is an all-in-one digital platform designed to inform, entertain, and empower...</p>
</div>

<script>
  const langMap = {
    en: 'ğŸ‡ºğŸ‡¸ English',
    ar: 'ğŸ‡¸ğŸ‡¦ Arabic',
    fr: 'ğŸ‡«ğŸ‡· French',
    es: 'ğŸ‡ªğŸ‡¸ Spanish',
    ja: 'ğŸ‡¯ğŸ‡µ Japanese',
    ko: 'ğŸ‡°ğŸ‡· Korean',
    zh: 'ğŸ‡¨ğŸ‡³ Chinese'
  };

  function googleTranslateInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: Object.keys(langMap).join(','),
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
      autoDisplay: false
    }, 'google_translate_element');
  }
</script>
<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateInit"></script>

<script>
  const btn = document.getElementById('translate-btn');
  const menu = document.getElementById('lang-menu');

  btn.addEventListener('click', e => {
    e.stopPropagation();
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
  });

  window.addEventListener('click', () => {
    menu.style.display = 'none';
  });

  // Populate language menu
  for (let code in langMap) {
    const div = document.createElement('div');
    div.textContent = langMap[code];
    div.dataset.lang = code;
    div.addEventListener('click', e => {
      e.stopPropagation();
      translateToLang(code);
      menu.style.display = 'none';
    });
    menu.appendChild(div);
  }

  function translateToLang(lang) {
    const combo = document.querySelector('.goog-te-combo');
    if (combo) {
      combo.value = lang;
      combo.dispatchEvent(new Event('change'));
      localStorage.setItem('selectedLang', lang);
    } else {
      setTimeout(() => translateToLang(lang), 200);
    }
  }

  window.addEventListener('load', () => {
    const saved = localStorage.getItem('selectedLang');
    if (saved && saved !== 'en') {
      translateToLang(saved);
    }
  });
</script>
