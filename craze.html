<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css">

<style>
  :root {
    --translate-bg: rgba(255, 255, 255, 0.5);
    --translate-border: black;
    --downicon-color: red;
    --langicon-color: blue;
    --translate-text-color: black;
    --translate-font: sans-serif;
  }
  
  body {
    top: 0px !important;
  }
  
  /* Position the Google Translate element off-screen */
  #google_translate_element {
    position: absolute;
    left: -9999px;
    opacity: 0;
    height: 0;
    overflow: hidden;
  }
  
  /* Custom language selector styles */
  .custom-language-selector {
    position: fixed;
    bottom: 1vh;
    right: 2vw;
    z-index: 100;
  }
  
  .language-button {
    background-color: var(--translate-bg);
    border: 1px solid var(--translate-border);
    border-radius: 4px;
    padding: 0.5em 1em;
    cursor: pointer;
    display: flex;
    align-items: center;
    font-family: var(--translate-font);
    color: var(--translate-text-color);
  }
  
  .language-button i {
    margin-right: 8px;
    color: var(--langicon-color);
  }
  
  .language-button .arrow {
    margin-left: 8px;
    color: var(--downicon-color);
    transition: transform 0.3s;
  }
  
  .language-button.open .arrow {
    transform: rotate(180deg);
  }
  
  .language-dropdown {
    position: absolute;
    bottom: 100%;
    right: 0;
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    max-height: 300px;
    overflow-y: auto;
    display: none;
    z-index: 101;
    min-width: 150px;
  }
  
  .language-dropdown.open {
    display: block;
  }
  
  .language-option {
    padding: 8px 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
  }
  
  .language-option:hover {
    background-color: #f5f5f5;
  }
  
  .language-flag {
    margin-right: 8px;
    font-size: 1.2em;
  }
  
  /* Google Translate banner hiding */
  .goog-te-banner-frame.skiptranslate {
    display: none !important;
  }
  
  body {
    top: 0px !important;
  }
  
  /* Ensure translated content maintains original styling */
  .translated-content {
    font-family: inherit !important;
    font-size: inherit !important;
    color: inherit !important;
  }
</style>

<!-- Website content container - must have class="notranslate" to prevent double translation -->
<div class="notranslate" id="website-content">
  <p>What is PortaFlux? PortaFlux is an all-in-one digital platform designed to inform, entertain, and empower users with a seamless experience across news, movies, tech updates, and smart digital content. Whether you're browsing the latest headlines, streaming trending videos, or exploring tech insights, PortaFlux delivers curated, quality content, right when you need it.
  
  It's not just a content hub, it's your daily destination for staying connected, learning something new, and discovering what matters.
  
  Key Features of PortaFlux:
  
  1. Daily News Feed</p>
</div>

<!-- Custom language selector -->
<div class="custom-language-selector">
  <div class="language-button" id="language-button">
    <i class="material-icons">language</i>
    <span class="current-language">English</span>
    <span class="arrow material-icons">arrow_drop_down</span>
  </div>
  <div class="language-dropdown" id="language-dropdown">
    <!-- Options will be populated by JavaScript -->
  </div>
</div>

<!-- Google Translate element - must be present but hidden -->
<div id="google_translate_element"></div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script>
  // Language configuration with flags
  const languages = [
    { code: 'en', name: 'English', flag: 'ðŸ‡ºðŸ‡¸' },
    { code: 'ar', name: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Arabic)', flag: 'ðŸ‡¸ðŸ‡¦' },
    { code: 'ja', name: 'æ—¥æœ¬èªž (Japanese)', flag: 'ðŸ‡¯ðŸ‡µ' },
    { code: 'ko', name: 'í•œêµ­ì–´ (Korean)', flag: 'ðŸ‡°ðŸ‡·' },
    { code: 'fr', name: 'FranÃ§ais (French)', flag: 'ðŸ‡«ðŸ‡·' },
    { code: 'sv', name: 'Svenska (Swedish)', flag: 'ðŸ‡¸ðŸ‡ª' },
    { code: 'is', name: 'Ãslenska (Icelandic)', flag: 'ðŸ‡®ðŸ‡¸' },
    { code: 'ro', name: 'RomÃ¢nÄƒ (Romanian)', flag: 'ðŸ‡·ðŸ‡´' },
    { code: 'fi', name: 'Suomi (Finnish)', flag: 'ðŸ‡«ðŸ‡®' },
    { code: 'et', name: 'Eesti (Estonian)', flag: 'ðŸ‡ªðŸ‡ª' },
    { code: 'it', name: 'Italiano (Italian)', flag: 'ðŸ‡®ðŸ‡¹' },
    { code: 'zh-CN', name: 'ä¸­æ–‡ (Chinese)', flag: 'ðŸ‡¨ðŸ‡³' },
    { code: 'tl', name: 'Tagalog (Filipino)', flag: 'ðŸ‡µðŸ‡­' }
  ];

  // Initialize Google Translate
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: languages.map(lang => lang.code).join(','),
      layout: google.translate.TranslateElement.InlineLayout.HORIZONTAL,
      autoDisplay: false
    }, 'google_translate_element');
    
    // Wait for Google Translate to initialize
    setTimeout(() => {
      const select = document.querySelector('.goog-te-combo');
      if (select) {
        select.style.display = 'none'; // Hide the default dropdown
        
        // Load saved language preference
        const savedLang = localStorage.getItem('selectedLang');
        if (savedLang) {
          select.value = savedLang;
          select.dispatchEvent(new Event('change'));
          
          // Update UI to show current language
          const lang = languages.find(l => l.code === savedLang);
          if (lang) {
            document.querySelector('.current-language').textContent = lang.name.split(' ')[0];
          }
        }
      }
    }, 500);
  }

  // Initialize the custom language selector
  document.addEventListener('DOMContentLoaded', function() {
    const languageButton = document.getElementById('language-button');
    const languageDropdown = document.getElementById('language-dropdown');
    const currentLanguage = document.querySelector('.current-language');
    
    // Populate the dropdown with language options
    languages.forEach(lang => {
      const option = document.createElement('div');
      option.className = 'language-option';
      option.dataset.lang = lang.code;
      option.innerHTML = `
        <span class="language-flag">${lang.flag}</span>
        <span>${lang.name}</span>
      `;
      languageDropdown.appendChild(option);
      
      option.addEventListener('click', function() {
        selectLanguage(lang.code, lang.name);
        languageButton.classList.remove('open');
        languageDropdown.classList.remove('open');
      });
    });
    
    // Toggle dropdown visibility
    languageButton.addEventListener('click', function(e) {
      e.stopPropagation();
      languageButton.classList.toggle('open');
      languageDropdown.classList.toggle('open');
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function() {
      languageButton.classList.remove('open');
      languageDropdown.classList.remove('open');
    });
  });
  
  // Function to change language
  function selectLanguage(langCode, langName) {
    const currentLanguage = document.querySelector('.current-language');
    currentLanguage.textContent = langName.split(' ')[0];
    
    // Save language preference
    localStorage.setItem('selectedLang', langCode);
    
    // Find and trigger the Google Translate dropdown
    const select = document.querySelector('.goog-te-combo');
    if (select) {
      select.value = langCode;
      select.dispatchEvent(new Event('change'));
    } else {
      // Fallback method if Google Translate isn't ready
      const interval = setInterval(() => {
        const select = document.querySelector('.goog-te-combo');
        if (select) {
          select.value = langCode;
          select.dispatchEvent(new Event('change'));
          clearInterval(interval);
        }
      }, 100);
    }
  }
  
  // Handle page translation by Google
  function handleTranslation() {
    // Add class to body when translation is active
    if (document.body.classList.contains('translated')) {
      document.querySelectorAll('.translated-content').forEach(el => {
        el.classList.add('notranslate');
      });
    }
  }
  
  // Monitor for translation changes
  setInterval(handleTranslation, 1000);
</script>